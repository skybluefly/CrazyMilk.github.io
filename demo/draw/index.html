<!DOCTYPE html>
<html lang="zh-ch">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="applicable-device" content="mobile">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title></title>
    <meta name="description" content="抽奖">
  <script>
   !(function(doc, win, size) {
       var pixelRatio = 1 / window.devicePixelRatio;
       document.write('<meta name="viewport" content="width=device-width,initial-scale=' + pixelRatio + ',minimum-scale=' + pixelRatio + ',maximum-scale=' + pixelRatio + ',user-scalable=no" />');
       var docEle = doc.documentElement,
           evt = "onorientationchange" in window ? "orientationchange" : "resize",
           fn = function() {
               var width = docEle.clientWidth;
               docEle.style.fontSize = (width / size) * 100 + "px";
           };
       fn();
       win.addEventListener(evt, fn, false);
       /*doc.addEventListener("DOMContentLoaded", fn, false);*/
   }(document, window, 750));
   </script>

    <link rel="stylesheet" href="css/swiper-3.4.2.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <!-- 第一屏 -->
            <div class="swiper-slide">
                    <img src="images/img-text1.png" alt="见证100亿的时刻" class="img-text1 effect">
                    <ul class="number">
                            <li data-ride="numberGrow" data-value="18" data-time="2"></li>
                            <li data-ride="numberGrow" data-value="9876" data-time="2"></li>
                            <li data-ride="numberGrow" data-value="5432" data-time="2"></li>
                    </ul>
                    <a class="rule" href="javascript:;" target="_blank" rel="external">活动<br>规则</a>
                    <div class="arrow">
                            <i></i>
                    </div>
            </div>
            <!-- 第一屏 END -->
            <!-- 第二屏 -->
            <div class="swiper-slide">

                    <a class="rule" href="javascript:;" target="_blank" rel="external">活动<br>规则</a>

                    <div class="page-box">
                        <div class="time-leave">
                                <div id="time" class="time-leave-control com-number">
                                </div>
                                <p class="times-text">今日剩余 <span><span id="crushTimes">0</span>次</span> 砸金蛋机会</p>
                                <img src="images/img-decorate.png" width="100%" alt="装饰" class="decorate">
                        </div>
                        <audio id="sound" class="sound">

                          <source src="images/sound.mp3" type="audio/mpeg">
                        </audio>

                        <div class="gold-egg clearfix" id="crushEgg">
                                <i class="gold-egg-decorate1"></i>
                                <div class="egg-box"><span class="egg effect" data-on="true"></span><i class=" sinker"></i></div>
                                <div class="egg-box"><span class="egg effect" data-on="true"></span><i class=" sinker"></i></div>
                                <div class="egg-box"><span class="egg effect" data-on="true"></span><i class=" sinker"></i></div>
                                <img src="images/img-decorate2.png" alt="" class="gold-egg-decorate2">

                        </div>
                        <a href="javascript:;" class="invite-friends" target="_blank" rel="external">喊朋友一起砸金蛋</a>
                        <p class="invite-friends-text">每成功邀请好友可额外获得1次砸金蛋机会</p>
                    </div>
                    <div class="arrow">
                            <i></i>
                    </div>
            </div>
            <!-- 第二屏 END -->
            <!--第三屏  -->
            <div class="swiper-slide">

                    <a class="rule" href="javascript:;" target="_blank" rel="external">活动<br>规则</a>
                    <div class="page-box">
                        <img src="images/img-title2.png" width="100%" alt="争做百亿预言帝，瓜分破百亿现金红包" class="img-title2">
                        <div class="date-list">

                                <i class="sling"></i>
                                <i class="sling"></i>
                                <div class="date-list-title">
                                        <div class="date-list-title-text com-number" id="predict">
                                        </div>
                                </div>
                                <ul class="date-list-item">
                                        <li>
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>
                                        <li class="active">
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>
                                        <li>
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>
                                        <li>
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>
                                        <li>
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>
                                        <li class="active">
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>
                                        <li>
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>
                                        <li>
                                                <h4>21日</h4>
                                                <p>已有888人预言</p>
                                                <a href="#">预言今日破百亿</a>
                                        </li>

                                </ul>
                        </div>
                    </div>
                   <div class="arrow up">
                            <i></i>
                    </div>
            </div>
            <!--第三屏  END-->
    </div>
</div>
<!--提示弹窗  -->
<div class="layer" id="tip">
        <div class="layer-box tip scrollable">
                <i class="pet"></i>
                <p class="layer-text1" id="tipText">还没有砸蛋机会哦~</p>
                <p class="layer-text2">每成功邀请好友<br>可额外获得一次砸金蛋的机会</p>
                <a href="javascript:;" class="layer-btn" target="_blank" rel="external">邀请好友砸金蛋</a>
                <a href="javascript:;" class="layer-close" target="_blank" rel="external"></a>
        </div>
</div>
<!--提示弹窗  END-->
<!--砸蛋奖品  -->
<div class="layer" id="prize">
        <div class="layer-box prize">

                    <i class="prize-img"></i>
                    <p class="layer-text3">恭喜您! 砸中现金1元~</p>
                    <a href="javascript:;" class="layer-btn" target="_blank" rel="external">邀请好友砸金蛋</a>
                    <p class="layer-text4">每成功邀请好友，可获得1次砸金蛋机会</p>
                     <a href="javascript:;" class="layer-close" target="_blank" rel="external"></a>
        </div>


</div>
<!--砸蛋奖品  END-->
<!--我的奖品  -->
<div class="layer" id="myPrize">
        <div class="layer-box prize-list">
                <div class="title">
                    <h3>我的奖品</h3>
                    <p><span class="fl">奖品</span><span class="fr">获取时间</span></p>
                </div>
                <div class="prize-list-box scrollable">
                    <ul>
                            <li>
                                    <i class="prize-img2"></i>
                                    <p class="fl">30元红包</p>
                                    <time class="fr">2017-05-08</time>
                            </li>
                            <li>
                                    <i class="prize-img2"></i>
                                    <p class="fl">25元红包</p>
                                    <time class="fr">2017-05-08</time>
                            </li>
                            <li>
                                    <i class="prize-img2"></i>
                                    <p class="fl">15元红包</p>
                                    <time class="fr">2017-05-08</time>
                            </li>
                            <li>
                                    <i class="prize-img2"></i>
                                    <p class="fl">30元红包</p>
                                    <time class="fr">2017-05-08</time>
                            </li>
                            <li>
                                    <i class="prize-img2"></i>
                                    <p class="fl">25元红包</p>
                                    <time class="fr">2017-05-08</time>
                            </li>
                            <li>
                                    <i class="prize-img2"></i>
                                    <p class="fl">15元红包</p>
                                    <time class="fr">2017-05-08</time>
                            </li>
                    </ul>
                </div>
                <a href="javascript:;" class="layer-close" target="_blank" rel="external"></a>
        </div>
</div>
<!--我的奖品  END-->

</body>

<script src="//cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.0/js/swiper.min.js"></script>
<script>
    $.smartScroll = function(container, selectorScrollable) {
    // 如果没有滚动容器选择器，或者已经绑定了滚动时间，忽略
    if (!selectorScrollable || container.data('isBindScroll')) {
        return;
    }

    // 是否是搓浏览器
    // 自己在这里添加判断和筛选
    var isSBBrowser;

    var data = {
        posY: 0,
        maxscroll: 0
    };

    // 事件处理
    container.on({
        touchstart: function(event) {
            var events = event.touches[0] || event;

            // 先求得是不是滚动元素或者滚动元素的子元素
            var elTarget = $(event.target);

            if (!elTarget.length) {
                return;
            }

            var elScroll;

            // 获取标记的滚动元素，自身或子元素皆可
            if (elTarget.is(selectorScrollable)) {
                elScroll = elTarget;
            } else if ((elScroll = elTarget.parents(selectorScrollable)).length == 0) {
                elScroll = null;
            }

            if (!elScroll) {
                return;
            }

            // 当前滚动元素标记
            data.elScroll = elScroll;

            // 垂直位置标记
            data.posY = events.pageY;
            data.scrollY = elScroll.scrollTop();
            // 是否可以滚动
            data.maxscroll = elScroll[0].scrollHeight - elScroll[0].clientHeight;
        },
        touchmove: function() {
            // 如果不足于滚动，则禁止触发整个窗体元素的滚动
            if (data.maxscroll <= 0 || isSBBrowser) {
                // 禁止滚动
                event.preventDefault();
            }
            // 滚动元素
            var elScroll = data.elScroll;
            // 当前的滚动高度
            var scrollTop = elScroll.scrollTop();

            // 现在移动的垂直位置，用来判断是往上移动还是往下
            var events = event.touches[0] || event;
            // 移动距离
            var distanceY = events.pageY - data.posY;

            if (isSBBrowser) {
                elScroll.scrollTop(data.scrollY - distanceY);
                elScroll.trigger('scroll');
                return;
            }

            // 上下边缘检测
            if (distanceY > 0 && scrollTop == 0) {
                // 往上滑，并且到头
                // 禁止滚动的默认行为
                event.preventDefault();
                return;
            }

            // 下边缘检测
            if (distanceY < 0 && (scrollTop + 1 >= data.maxscroll)) {
                // 往下滑，并且到头
                // 禁止滚动的默认行为
                event.preventDefault();
                return;
            }
        },
        touchend: function() {
            data.maxscroll = 0;
        }
    });

    // 防止多次重复绑定
    container.data('isBindScroll', true);
};

</script>
<script src="js/lib/NumberGrow.js"></script>
<script>
    /**
 *
 * @authors Your Name (you@example.org)
 * @date    2017-07-18 18:52:42
 * @version $Id$
 */
$(function() {
    var _this;
    var main = {
        expiringTime: null,
        currentTime: null,
        crushState: true,
        crushTimes: 3,
        setTimeLeave: "July 18,2017 23:38:59",
        timeDiff: 0,
        predictNum: 1059,
        audio: null,
        init: function() {
            _this = this;
            _this.predictFn();
            $(".rule").click(function() {
                _this.layer("#myPrize");
            });
            $(".layer-close").click(function() {
                $(this).parents('.layer').removeClass('active');
                $('html').removeClass('noscroll');
                $(".egg-box").removeClass('disabled');
                _this.audio.load();
            });
            var swiper = new Swiper('.swiper-container', {
                direction: 'vertical',
                onInit: function(swiper) {
                    $('.swiper-slide-active').find('.effect').addClass('css3');
                },
                onSlideChangeStart: function(swiper) {
                    $('.swiper-slide').find('.effect').removeClass('css3');
                    $('.swiper-slide-active').find('.effect').addClass('css3');
                }
            });
            $('[data-ride="numberGrow"]').each(function() {
                new NumberGrow(this);
            });
            _this.timeDiffFn();
            if (_this.timeDiff >= 0) {
                _this.countdown();
                $(".egg-box").click(function() {
                    $("#tipText").html("还没到时间砸蛋哦！")
                    _this.layer("#tip");
                });
            } else {
                $("#crushTimes").html(_this.crushTimes);
                $(".egg").click(function() {
                    var el = $(this);
                    var elCuizi = el.next(".sinker");
                    _this.audio = document.getElementById('sound');
                    if (!_this.crushState) {
                        return;
                    };
                    if (!el.data("on")) {
                        $("#tipText").html("已砸过了！亲~")
                        _this.layer("#tip");
                        return;
                    } else {
                        $(".egg-box").addClass('disabled');
                        elCuizi.addClass('active');
                        _this.audio.play();
                        if (_this.crushTimes === 0) {
                            _$("#tipText").html("还没有砸蛋机会哦~")
                            _this.layer("#tip");
                            return;

                        } else {
                            _this.crushTimes--;
                        };
                    };
                    _this.crushState = false;

                    elCuizi[0].addEventListener("webkitAnimationEnd", function() {
                        el.addClass('active');
                        var This = this;
                        setTimeout(function() {
                            This.style.display = "none";
                            _this.layer("#prize");

                            $("#crushTimes").html(_this.crushTimes);
                        }, 1500);
                        el.data("on", "false");
                        _this.crushState = true;

                    }, false);

                });



            };
        },
        predictFn: function() {
            var num = 0;
            var numTimer = null;
            numTimer = setInterval(function() {
                _this.predictNum++;
                var numHtml = [];
                numHtml.push("<p>已有</p>");
                var numStr = _this.formatNum(_this.predictNum) + "";
                numStr.split("").forEach(function(item) {
                    numHtml.push("<span>" + item + "</span>");
                });
                numHtml.push("<p>人预言</p>");
                $("#predict").html(numHtml.join(''));
            }, 1000)
        },
        countdown: function() {
            var timer = null;
            timer = setInterval(function() {
                _this.timeDiffFn();
                if (_this.timeDiff >= 0) {
                    var hour = (Math.floor(_this.timeDiff / 86400) * 24 + Math.floor(_this.timeDiff % 86400 / 3600)) + "";
                    var minute = (Math.floor(_this.timeDiff % 86400 % 3600 / 60)) + "";
                    var second = (_this.timeDiff % 60) + "";
                    var html = [];
                    html.push("<div>");
                    html.push("<p>还剩</p>");
                    _this.setTimeHtml(hour, html);
                    html.push("<i>:</i>");
                    _this.setTimeHtml(minute, html);
                    html.push("<i>:</i>");
                    _this.setTimeHtml(second, html);
                    html.push("<p>开砸</p>");
                    html.push("</div>");
                    $('#time').html(html.join(''));
                } else {
                    clearInterval(timer);
                }
            }, 1000);
        },
        timeDiffFn: function() {
            _this.currentTime = new Date();
            _this.expiringTime = new Date(_this.setTimeLeave);
            _this.timeDiff = Math.floor((_this.expiringTime - _this.currentTime) / 1000);
        },
        setTimeHtml: function(time, html) {
            time.split("").forEach(function(item) {
                if (time < 10) {
                    html.push('<span>0</span>');
                    html.push('<span>' + item + '</span>');
                } else {
                    html.push('<span>' + item + '</span>');
                };

            });
        },
        layer: function(obj) {
            $(obj).addClass('active');
            var elLayer = $(obj)
            $.smartScroll(elLayer, ".scrollable");
            $('html').addClass('noscroll');
        },
        formatNum: function(n) {
            var b = parseInt(n).toString();
            var len = b.length;
            if (len <= 3) { return b; }
            var r = len % 3;
            return r > 0 ? b.slice(0, r) + "," + b.slice(r, len).match(/\d{3}/g).join(",") : b.slice(r, len).match(/\d{3}/g).join(",");
        }
    }
    main.init()

})

</script>
</html>
